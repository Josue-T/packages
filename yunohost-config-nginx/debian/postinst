#!/bin/bash

TMP="/usr/share/yunohost/yunohost-config/nginx"

cp $TMP/ssowat.conf /etc/nginx/conf.d/
cp $TMP/yunohost_panel.conf.inc /etc/nginx/conf.d/
cp $TMP/yunohost_admin.conf.inc /etc/nginx/conf.d/
cp $TMP/yunohost_api.conf.inc /etc/nginx/conf.d/

rm -f /etc/nginx/conf.d/ynhadmin.conf

if [ ! -f /etc/yunohost/installed ];
then
        cp $TMP/yunohost_admin.conf /etc/nginx/conf.d/
fi

if [ -f /etc/nginx/sites-enabled/default ];
then
	rm /etc/nginx/sites-enabled/default
fi

sed -i "s@ynhadmin@yunohost/admin@g" /etc/nginx/conf.d/*.conf
sed -i "s@ynhapi@yunohost/api@g" /etc/nginx/conf.d/*.conf

dpkg -l | grep openresty
if [[ $? -eq 0 ]]; then
    cp $TMP/openresty.conf /etc/nginx/conf.d/
fi

service nginx restart > /dev/null 2>&1
exit 0
